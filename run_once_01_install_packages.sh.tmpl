#!/bin/bash

{{ if eq .chezmoi.os "darwin" }}

DOWNLOAD_DIR="$HOME/Downloads"
BREW_PATH="/opt/homebrew/bin"

# if brew is not installed, install it
if ! command -v brew &> /dev/null; then
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    export PATH="$PATH:$BREW_PATH"
fi

# if iTerm2 is not installed, install it
if [ ! -d "/Applications/iTerm.app" ]; then
    mkdir -p $DOWNLOAD_DIR
    wget -P $DOWNLOAD_DIR -O iterm.zip https://iterm2.com/downloads/stable/latest
    unzip $DOWNLOAD_DIR/iterm.zip -d /Applications
    rm $DOWNLOAD_DIR/iterm.zip
    mkdir -p ~/.local/share/iterm2
    curl -L https://iterm2.com/shell_integration/zsh \
    -o ~/.local/share/iterm2/shell_integration.zsh
fi
{{ end }}

COMMAND_LIST=(vim nvim wget curl shellcheck coreutils git tmux fzf lazygit lazydocker)

{{ if eq .chezmoi.os "darwin" }}

brew install "${COMMAND_LIST[@]}"
brew install --cask font-jetbrains-mono-nerd-font

{{ else if eq .chezmoi.os "linux" }}

COMMAND_LIST+=("zsh")
sudo apt update && sudo apt install -y "${COMMAND_LIST[@]}"

{{ end }}

if [ ! -d ~/.local/share/tmux/plugins/tpm ]; then
    git clone https://github.com/tmux-plugins/tpm ~/.local/share/tmux/plugins/tpm
fi
if [ ! -d ~/.local/share/zinit/zinit.git ]; then
    git clone https://github.com/zdharma-continuum/zinit.git ~/.local/share/zinit/zinit.git
fi
if [ ! -d ~/.config/nvim ]; then
    git clone https://github.com/NvChad/starter ~/.config/nvim
fi

mkdir -p ~/.config/zsh/completions

# if profile file does not exist, create an empty one
if [ ! -f ~/.config/zsh/profile ]; then
    touch ~/.config/zsh/profile
fi

# if mise is not installed, install it
if ! command -v mise &> /dev/null; then
    curl https://mise.run | sh
    touch ~/.config/mise/config.local.toml
fi

# if zsh is not the default shell, remind user to change it
if [ "$SHELL" != "$(which zsh)" ]; then
    echo 'run chsh -s "$(which zsh)" to change your default shell to zsh after applying dotfiles.'
fi
